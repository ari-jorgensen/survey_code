<!DOCTYPE html>
<html>
<head>
    <title>Demo Module 1</title>
</head>

<body>

<div id="demo1">
    <h3>Select the chart with the <strong>HIGHER</strong> opacity.</h3>
    <div class="chart-container">
        <h2 class="chart-child" id="chart1">Chart 1</h2>
        <h2 class="chart-child" id="chart2">Chart 2</h2>
    </div>
    <div class="chart-container">
    </div>


    <div class="chart-container">
        <p>Select which chart has the higher opacity.
            <select id="q1" name="q1">
                <option value="1">Chart 1</option>
                <option value="2">Chart 2</option>
            </select>
        </p>
    </div>




</div>


<script>
    (function() {
        var data = {}
            , questions = [1]; // questions to be set by d3

        init();

        function init(){

            // Showing opacity for testing purposes only
            if (experimentr.debug === 'true') {
                d3.select('#chart1').append('div').text(experimentr.opacityStatic);
                d3.select('#chart2').append('div').text(experimentr.opacity);
            }

            //overrides onNext from experimentr
            d3.select('#next-button')
                .on('click', function(){
                    experimentr.endTimer(String(experimentr.question));
                    data[experimentr.dataString+String(experimentr.question)] = experimentr.gradeQuestion(data["demo1_1"]);
                    experimentr.addData(data);
                    if (experimentr.checkConvergenceCriteria() == true) {
                        alert('Criteria met, survey finished!');
                        experimentr.end();
                        experimentr.save(experimentr.data);
                    } else {
                        experimentr.question += 1;
                        experimentr.next();
                    }
                });

            experimentr.startTimer(String(experimentr.question));
            experimentr.release();
            display();
        }

        // TODO: Add confidence slider (1-7)
        function display(){
            d3.select('h3')
                .append('div')
                .text('Question ' + experimentr.question);

            d3.select(".chart-container")
                .append("iframe")
                .attr("src", "https://alark.github.io/aesthetics/synthetic2/chart" + experimentr.opacityStatic +".png")
                .attr("class", "chart-child")
                .attr("height", "350px")
                .style("border", "none");
            d3.select(".chart-container")
                .append("iframe")
                .attr("src", "https://alark.github.io/aesthetics/synthetic2/chart" + experimentr.opacity +".png")
                .attr("class", "chart-child")
                .attr("height", "350px")
                .style("border", "none");

            questions.forEach(function(question){
                document.getElementById('q' + question).selectedIndex = -1;
            });

            // This function sets the user's answer after they make a selection
            d3.select('#q1').on('change', function() {
                data["demo1_1"] = this.options[this.selectedIndex].value;
            });

        }


    }());
</script>
</body>
</html>
